<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2017-03-29">

<title>How to effectively pre-register your research: a case-study of my own mistakes – James E Bartlett</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-8E3YC31DY9"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-8E3YC31DY9', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">James E Bartlett</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../research.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../resources.html"> 
<span class="menu-text">Open Educational Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../talks.html"> 
<span class="menu-text">Workshops and Talks</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#my-first-attempt" id="toc-my-first-attempt" class="nav-link active" data-scroll-target="#my-first-attempt">My first attempt</a></li>
  <li><a href="#useful-resources" id="toc-useful-resources" class="nav-link" data-scroll-target="#useful-resources">Useful resources</a>
  <ul class="collapse">
  <li><a href="#improving-your-statistical-inferences-mooc" id="toc-improving-your-statistical-inferences-mooc" class="nav-link" data-scroll-target="#improving-your-statistical-inferences-mooc">Improving your Statistical Inferences MOOC</a></li>
  <li><a href="#pre-registration-in-social-psychology-a-discussion-and-suggested-template" id="toc-pre-registration-in-social-psychology-a-discussion-and-suggested-template" class="nav-link" data-scroll-target="#pre-registration-in-social-psychology-a-discussion-and-suggested-template">Pre-registration in social psychology – a discussion and suggested template</a></li>
  <li><a href="#other-pre-registrations" id="toc-other-pre-registrations" class="nav-link" data-scroll-target="#other-pre-registrations">Other pre-registrations</a></li>
  </ul></li>
  <li><a href="#my-suggested-template-for-pre-registration" id="toc-my-suggested-template-for-pre-registration" class="nav-link" data-scroll-target="#my-suggested-template-for-pre-registration">My suggested template for pre-registration</a></li>
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">1. Background</a></li>
  <li><a href="#objectives-and-hypotheses" id="toc-objectives-and-hypotheses" class="nav-link" data-scroll-target="#objectives-and-hypotheses">2. Objectives and hypotheses</a>
  <ul class="collapse">
  <li><a href="#aims" id="toc-aims" class="nav-link" data-scroll-target="#aims">2.1. Aims</a></li>
  </ul></li>
  <li><a href="#study-design" id="toc-study-design" class="nav-link" data-scroll-target="#study-design">3. Study design</a></li>
  <li><a href="#participants-and-recruitment" id="toc-participants-and-recruitment" class="nav-link" data-scroll-target="#participants-and-recruitment">4. Participants and recruitment</a></li>
  <li><a href="#measures-and-materials" id="toc-measures-and-materials" class="nav-link" data-scroll-target="#measures-and-materials">5. Measures and materials</a>
  <ul class="collapse">
  <li><a href="#measures" id="toc-measures" class="nav-link" data-scroll-target="#measures">5.1. Measures</a></li>
  </ul></li>
  <li><a href="#procedure" id="toc-procedure" class="nav-link" data-scroll-target="#procedure">6. Procedure</a></li>
  <li><a href="#statistical-plan" id="toc-statistical-plan" class="nav-link" data-scroll-target="#statistical-plan">7. Statistical plan</a>
  <ul class="collapse">
  <li><a href="#data-screening-procedure" id="toc-data-screening-procedure" class="nav-link" data-scroll-target="#data-screening-procedure">7.1. Data screening procedure</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">8. References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">How to effectively pre-register your research: a case-study of my own mistakes</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 29, 2017</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Psychology has got some trust issues. It used to be the case that when authors wrote they had a specific hypothesis or they were interested in a specific dependent variable, you just took their word for it. However, there has been a series of high profile articles highlighting how researchers engage in questionable research practices (QRPs) such as hypothesising after the results are known (HARKing; <a href="http://journals.sagepub.com/doi/abs/10.1207/s15327957pspr0203_4?url_ver=Z39.88-2003&amp;rfr_id=ori:rid:crossref.org&amp;rfr_dat=cr_pub%3dpubmed">Kerr 1998</a>) and selectively reporting only the variables that are statistically significant <a href="http://www.haas.berkeley.edu/groups/online_marketing/facultyCV/papers/nelson_false-positive.pdf">(Simmons, Nelson and Simonsohn 2011)</a>. To regain some trust and reduce the impact of QRPs, many authors are now pre-registering their studies. Pre-registration is where authors state in advance what their aims and hypotheses are for the study, along with sample size calculations and which measures are going to be used. When the study is complete and written up for publication, anyone can cross-reference what they have reported in comparison to their pre-registration. Although it has supposedly been compulsory for <a href="http://www.alltrials.net/find-out-more/all-trials/">clinical trials to be pre-registered</a> for decades, pre-registration in psychology is relatively new and the emphasis has increased since the replicability of psychological research has been called into question <a href="http://science.sciencemag.org/content/349/6251/aac4716">(Open Science Collaboration 2015)</a>.</p>
<p>The focus of this post is on how you can effectively pre-register your study with a case-study of how not to do it…my own first attempt. I will point out what is wrong with my first attempt and highlight some resources that have been particularly useful in improving my own knowledge. I was inspired by Katherine Wood’s <a href="https://inattentionalcoffee.wordpress.com/2017/01/03/open-science-in-practice/">blog post</a> on her experience of starting her graduate programme after the fall-out of the replication crisis. She identified that current graduate students have the opportunity to start their research career following an open science approach, as opposed to changing practices further into their career. I too started my graduate programme after becoming aware of the issues of replicability in psychology, but I did not know anyone else at my institution who pre-registered their research and there was not exactly a “pre-registration for dummies” to turn to. However, there are now several articles and blog posts explaining how you can pre-register your research (e.g.&nbsp;<a href="http://www.psychologicalscience.org/observer/research-preregistration-101#.WNuVNhLyuLI">Research Pre-registration 101</a>). This post is aimed at those who are yet to pre-register their research, or are perhaps in the same boat as me where you have tried and not quite got there with the first attempt. There are some resources that I have found invaluable in improving how I pre-register my research, and a suggested template that you can follow.</p>
<p>Note: this is about what <a href="https://osf.io/sn6by/">van ’t Veer and Giner-Sorolla (2016)</a> call unreviewed pre-registration, where the author time stamps their pre-registration document on a platform such as the Open Science Framework (OSF). However, there are also reviewed pre-registrations or Registered Reports. van ’t Veer and Giner-Sorolla (2016) and <a href="http://blog.efpsa.org/2016/04/14/replicability-and-registered-reports/">Dablander (2016)</a> have previously written about the distinction so I would direct you there for a more elaborate discussion. I have also previously interviewed <a href="http://blog.efpsa.org/2016/09/09/publishing-a-registered-report-as-a-postgraduate-researcher/">Dr.&nbsp;Hannah Hobson</a> about her experience of publishing a Registered Report during her PhD if you are interested in the experience of publishing one. There is also a (growing) list of journals that accept Registered Reports which can be found via the <a href="https://cos.io/rr/?_ga=1.26500537.543185544.1456424379">Centre for Open Science</a>.</p>
<section id="my-first-attempt" class="level2">
<h2 class="anchored" data-anchor-id="my-first-attempt">My first attempt</h2>
<p>The pre-registration for the first study of my PhD can be found on <a href="https://osf.io/h9ex7/">the OSF</a>. I cannot remember the exact point in time, but I was not aware of pre-registration in psychological research until I was planning the first study of my PhD. I had followed the discussions on Twitter and read some eye-opening articles about why it was important. However, I had not read someone else’s pre-registration and none of my supervisory team were aware of it. I was determined to do some good science so I did what I thought at the time was a good job as I had never seen another pre-registration document.</p>
<p>If you have looked at my pre-registration, you will probably notice some immediate issues. I will break it down into a list of what I now see as far from ideal.</p>
<ol type="1">
<li>The aim of my study was to investigate differences between three smoking sub-groups: light smokers, heavy smokers, and a non-smoking control group. A good point is that I outlined a sampling plan to collect 20 non-smokers and 40 smokers as optional stopping has been identified as hugely problematic for increasing type one errors (Simmons et al.&nbsp;2011). However, I did not justify how I calculated the sample size and I did not outline the inclusion/exclusion criteria.</li>
<li>I originally stated I was unclear about the hypotheses due to a combination of rushing before I started collecting data, conflicting previous research, and I was still in undergraduate mode of being terrified to stick my neck out and make actual predictions. I uploaded an updated version later on but if anything this makes it look worse, as despite being transparent on where I was with collecting data, people have to take my word on whether I had not looked at the data yet.</li>
<li>There was no information on the procedure and how the data collection would be taking place.</li>
<li>Although it is not always included in pre-registration, a plan of data-screening could be included to avoid researcher degrees of freedom in data-analysis.</li>
</ol>
<p>All in all, it’s not great. However, I was still in the first six months of my PhD and I did not have anyone to learn from who had done it before. Now being in the second year of my PhD and having had the time to read around, there are several resources that have helped me to improve dramatically as I write a more thorough pre-registration for my second study.</p>
</section>
<section id="useful-resources" class="level2">
<h2 class="anchored" data-anchor-id="useful-resources">Useful resources</h2>
<section id="improving-your-statistical-inferences-mooc" class="level3">
<h3 class="anchored" data-anchor-id="improving-your-statistical-inferences-mooc">Improving your Statistical Inferences MOOC</h3>
<p>Firstly, week seven of <a href="https://www.coursera.org/learn/statistical-inferences">Daniël Lakens’ MOOC</a> on Coursera has an assignment which focuses on how to conduct a study following an open science approach. There is a useful guide for leading you through pre-registration either through the template on <a href="https://aspredicted.org/">aspredicted.com</a> or directly through the OSF. There is also a handy guide for how you can organise folders for each section of your project on the OSF.</p>
</section>
<section id="pre-registration-in-social-psychology-a-discussion-and-suggested-template" class="level3">
<h3 class="anchored" data-anchor-id="pre-registration-in-social-psychology-a-discussion-and-suggested-template">Pre-registration in social psychology – a discussion and suggested template</h3>
<p>I only came across this article by van ’t Veer and Giner-Sorolla (2016) when I first started writing this post. My original idea was to write something like this article, but they have done a much better job than I ever would. The article can be briefly summarised as the historical antecedents of pre-registration in psychology, the benefits it can provide, some common apprehensions and limitations, and finally their suggested pre-registration template.</p>
</section>
<section id="other-pre-registrations" class="level3">
<h3 class="anchored" data-anchor-id="other-pre-registrations">Other pre-registrations</h3>
<p>One of the difficulties I encountered when I wrote my first pre-registration is that I had nothing to base it on. This will probably be less of a problem if your supervisor can show you an example of theirs, but I did not know what it was supposed to look like. Therefore, another valuable resource I learned from is having a look at the pre-registrations of other researchers or institutions. You can browse the OSF to find a project that is in a similar field to your own research. A particularly good example of how to pre-register in my field of research (psychopharmacology) is the Tobacco and Alcohol Research Group at the University of Bristol. Quite admirably, they have a <a href="http://www.insight.mrc.ac.uk/2015/06/05/opinion-going-public-with-your-research/">research group wide policy</a> of pre-registration everything from undergraduate dissertations to grant funded projects. Reading some of their examples helped me to improve the way in which I write my pre-registrations and know what information to include.</p>
</section>
</section>
<section id="my-suggested-template-for-pre-registration" class="level2">
<h2 class="anchored" data-anchor-id="my-suggested-template-for-pre-registration">My suggested template for pre-registration</h2>
<p>These are the headings and sub-headings that I have used to pre-register my current study. They are an amalgamation of all the resources I have read whilst I have been preparing my next study. There is no universally agreed upon template so you could add additional headings if there is further information that you think is important for your project.</p>
<hr>
</section>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">1. Background</h2>
<p>This is pretty much a very short introduction section. What previous research has influenced your study and what problem are you trying to address?</p>
</section>
<section id="objectives-and-hypotheses" class="level2">
<h2 class="anchored" data-anchor-id="objectives-and-hypotheses">2. Objectives and hypotheses</h2>
<section id="aims" class="level3">
<h3 class="anchored" data-anchor-id="aims">2.1. Aims</h3>
<p>The aim(s) of your study. What are you trying to achieve? ### 2.2. Hypotheses What are your predictions, what do you think is going to happen?</p>
</section>
</section>
<section id="study-design" class="level2">
<h2 class="anchored" data-anchor-id="study-design">3. Study design</h2>
<p>A brief outline of the design of the study. What are the IVs and what are the DVs?</p>
</section>
<section id="participants-and-recruitment" class="level2">
<h2 class="anchored" data-anchor-id="participants-and-recruitment">4. Participants and recruitment</h2>
<p>I start off with a summary of the sample I am trying to obtain. How many groups do you have, how many participants will be in each group, and how are you going to recruit them? ### 4.1. Inclusion criteria What characteristics are you interested in? What makes them eligible to take part in your research.<br>
### 4.2. Exclusion criteria What characteristics could your participant have so that it would not be a good idea for them to take part. You just need to be transparent on the criteria you are using to exclude people to reduce researcher degrees of freedom (<a href="http://www.stat.columbia.edu/~gelman/research/unpublished/p_hacking.pdf">Gelman and Loken 2013</a>). ### 4.3. Sample size calculation You need to justify your sample size to show it is well powered. This is something I did not do in my first attempt at pre-registration, and it is an important consideration as both optional stopping (Simmons et al.&nbsp;2011) and low statistical power (<a href="http://www.nature.com/nrn/journal/v14/n5/abs/nrn3475.html">Button et al.&nbsp;2013</a>) have been shown to be problematic.</p>
</section>
<section id="measures-and-materials" class="level2">
<h2 class="anchored" data-anchor-id="measures-and-materials">5. Measures and materials</h2>
<section id="measures" class="level3">
<h3 class="anchored" data-anchor-id="measures">5.1. Measures</h3>
<p>How are you measuring your DV? You can outline the specific task(s) you are using. Make sure you are being transparent and list all the measures to ensure you are not selectively reporting only the statistically significant ones. ### 5.2. Materials Here you can outline the questionnaires that your participants have completed. Again, be transparent and list all the materials involved.</p>
</section>
</section>
<section id="procedure" class="level2">
<h2 class="anchored" data-anchor-id="procedure">6. Procedure</h2>
<p>How are you going to collect the data? This does not have to be extensive, but include an outline of the data collection sessions.</p>
</section>
<section id="statistical-plan" class="level2">
<h2 class="anchored" data-anchor-id="statistical-plan">7. Statistical plan</h2>
<section id="data-screening-procedure" class="level3">
<h3 class="anchored" data-anchor-id="data-screening-procedure">7.1. Data screening procedure</h3>
<p>When you analyse the data, how are you going to screen and clean the data? This is again to reduce the impact of researcher degrees of freedom as there are many ways of doing this. It’s important to note here that this is not a straightjacket. Unless you have a crystal ball, there may be times when something unexpected happens. You do not have to rigidly follow this, but it allows you to transparently say “this is what I planned, but because of x, y, and z I had to do this instead”.<br>
### 7.2. Planned analyses What are the planned analyses you are going to perform to answer your research question? For example, following the recommendation of <a href="https://link.springer.com/article/10.3758/s13423-015-0913-5">Cramer et al.&nbsp;(2016)</a>, you can pre-register specific effects of interest in a factorial ANOVA to reduce multiplicity.</p>
</section>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">8. References</h2>
<p>You can end on a reference list for the sources you used throughout the document.</p>
<hr>
<p>Hopefully this post and the resources have helped if you were uncertain about how to pre-register your study. More and more journals are asking for evidence of studies being pre-registered and it is only a matter of time before it is largely compulsory for experimental research to be pre-registered. The opportunity is here to get ahead of the tide and ensure you are following open science practices. There are common concerns voiced about pre-registration with one of the most frequent being it stifles exploration. However, this is simply not true. The idea behind pre-registration is that you can show what is confirmatory research and what you have found through exploratory research. Exploration is an important creative process and the benefits can be summarised with a quote from John Tukey’s <em>Exploratory Data Analysis</em> (1977: page 3): &gt; “[R]estricting one’s self to the planned analysis—failing to accompany it with exploration—loses sight of the most interesting results too frequently to be comfortable”</p>
<p>You just need to be open and say what you wanted to confirm and what you found through exploration, it’s all about transparency and honesty.</p>
<p>I am not the first to outline how you can pre-register your study, and there are other more thorough accounts such as van ’t Veer and Giner-Sorolla (2016) which I would recommend you refer to. However, I made some mistakes during my first attempt at pre-registration. Hopefully you can learn from these mistakes if you are yet to pre-register your research or like me did not do a great job with the first attempt. I hope the resources throughout this post can be useful and if you have any further suggestions on helpful resources, please suggest them below and I can add them in.</p>


</section>

<p><a href="https://creativecommons.org">This website</a> © 2025 by <a href="https://creativecommons.org">James Bartlett</a> is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a><img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" style="max-width: 1em;max-height:1em;margin-left: .2em;"><img src="https://mirrors.creativecommons.org/presskit/icons/by.svg" style="max-width: 1em;max-height:1em;margin-left: .2em;"></p></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>