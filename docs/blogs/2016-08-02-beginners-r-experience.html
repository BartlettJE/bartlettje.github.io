<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>A beginner’s experience of learning R – James E Bartlett</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-8E3YC31DY9"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-8E3YC31DY9', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">James E Bartlett</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../research.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../resources.html"> 
<span class="menu-text">Open Educational Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../talks.html"> 
<span class="menu-text">Workshops and Talks</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#my-background" id="toc-my-background" class="nav-link active" data-scroll-target="#my-background">My background</a></li>
  <li><a href="#a-false-start" id="toc-a-false-start" class="nav-link" data-scroll-target="#a-false-start">A false start</a></li>
  <li><a href="#another-go" id="toc-another-go" class="nav-link" data-scroll-target="#another-go">…Another go</a></li>
  <li><a href="#steady-progress" id="toc-steady-progress" class="nav-link" data-scroll-target="#steady-progress">Steady progress</a></li>
  <li><a href="#current-progress" id="toc-current-progress" class="nav-link" data-scroll-target="#current-progress">Current progress</a></li>
  <li><a href="#tips-for-progressing-with-r" id="toc-tips-for-progressing-with-r" class="nav-link" data-scroll-target="#tips-for-progressing-with-r">Tips for progressing with R</a></li>
  <li><a href="#useful-resources" id="toc-useful-resources" class="nav-link" data-scroll-target="#useful-resources">Useful resources</a>
  <ul class="collapse">
  <li><a href="#books" id="toc-books" class="nav-link" data-scroll-target="#books">Books</a></li>
  <li><a href="#blogs" id="toc-blogs" class="nav-link" data-scroll-target="#blogs">Blogs</a></li>
  <li><a href="#other" id="toc-other" class="nav-link" data-scroll-target="#other">Other</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">A beginner’s experience of learning R</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Throughout my undergraduate psychology degree, I had exclusively used SPSS (to the point where I thought it was the only way to do data-analysis), and it was only during my Master’s degree that I came across R as a data-analysis language and environment. I did not know anyone else who used R, and I did not see anything online for what it is like to learn how to use it. Therefore, I thought it might to be useful to share my experience of learning R for anyone else who wants to learn but does not know where to start.</p>
<p>I’ll start by providing a bit of my background and what drew me to using R, and then outline the beginning of my experience. I’ll end with some tips that might be useful for anyone else in a similar position, and an annotated list of resources that have been indispensable to me.</p>
<section id="my-background" class="level2">
<h2 class="anchored" data-anchor-id="my-background">My background</h2>
<p>I am currently a psychology PhD student and my research is exclusively quantitative. Research methods and statistics were my favourite modules throughout my undergraduate psychology degree, and I have a decent understanding of data-analysis. However, my whole education was built on using SPSS. There is nothing specifically wrong with it but I think it creates bad habits through the ease in which you can just click through menus, and there are certain things that it is not suited for. For example, the plots that it produces are notoriously ugly, and there is no platform to perform some more advanced analyses. What I am trying to get at here is that when I started to learn R I had a good education in data-analysis, but the main barrier was my lack of experience in programming.</p>
</section>
<section id="a-false-start" class="level2">
<h2 class="anchored" data-anchor-id="a-false-start">A false start</h2>
<p>My first engagement with R was through Roger Peng’s book R Programming for Data Science. I had seen R mentioned from place to place but I had never used it myself (or knew anyone else who used it at my university). I thought the book would be a good place to start, but I found it overwhelming for someone who had no prior experience in programming or using R. It is a great book for learning more about R as a programming language, but I did not have any context to work with and it all became very confusing. It was like trying to learn a foreign language by learning the underlying grammar before you know any vocabulary. I quickly become lost and gave up trying.</p>
</section>
<section id="another-go" class="level2">
<h2 class="anchored" data-anchor-id="another-go">…Another go</h2>
<p>A month or two later, an introduction to R workshop was held at my university and being guided through the environment in a structured format allowed me to see how it all fitted together. I was able to see how you entered data, I was able to learn some of the coding basics, and I was able to see how a t-test was performed. This was much more tangible, and I started to see how key components of the R language were structured.</p>
</section>
<section id="steady-progress" class="level2">
<h2 class="anchored" data-anchor-id="steady-progress">Steady progress</h2>
<p>The main learning curve for getting to grips with the R language was overcome by following online tutorials. The first couple of months I used R exclusively for creating plots of some old data for a conference poster. I would look at tutorials on websites such as R-bloggers (see resources below) to copy their code and adapt it to use my own data. Trial and error has been one of the best strategies for me (see tips below). I would start with an online example, try to adapt it to fit my own data, and be bombarded with error messages stating something is wrong.</p>
</section>
<section id="current-progress" class="level2">
<h2 class="anchored" data-anchor-id="current-progress">Current progress</h2>
<p>It has taken around eight months (from December 2015) to reach my current level of understanding. There have been many times when I have become frustrated at not being able to work out what I have done wrong, but the key to learning R is persistence (see tips). Whenever I have made significant progress, it has been because I have sat in front of my laptop for a few hours and worked on a specific task. A large amount of trial and error is involved (especially when the programming language is unfamiliar), and you need to look past all the error messages. Unless you are comfortable with programming, there is a steep initial learning curve, but it becomes progressively easier with time and experience.</p>
<p>I’ve gone through this process for eight months now and I’m finally seeing some rewarding progress. Looking back, I have a few tips and resources that I wish I was aware of. Hopefully if you are reading this and are either new to using R or want to begin to use it, you will find them useful and avoid some of the head-scratching that I have done.</p>
</section>
<section id="tips-for-progressing-with-r" class="level2">
<h2 class="anchored" data-anchor-id="tips-for-progressing-with-r">Tips for progressing with R</h2>
<ol type="1">
<li>Persistence</li>
</ol>
<p>My main tip for learning R (especially if you have limited programming experience) is persistence. You will receive more error messages than you receive actual output, but try not to be put off by it, and try to stick at it until you work out what the problem is. You might need to take a break and look at it with a fresh pair of eyes, but make sure you do not give up until you have produced what you set out to do. Most of these experiences are useful for the future, as problems that have taken a large amount of time to overcome become easier to spot in future.</p>
<ol start="2" type="1">
<li>Have a clear goal in mind</li>
</ol>
<p>When I first started using R, my aim was to just learn R. This is quite vague, and unless you’re enrolled on a course or following a guide, it is difficult to know exactly where to start and how to progress. I started to see more progress when I had a clear goal, which in my case was making some plots for a conference poster. I knew what I wanted to produce as an output, so it was just a matter of learning what R code was necessary to produce it.</p>
<ol start="3" type="1">
<li>Use online tutorials</li>
</ol>
<p>The chances are that each analysis you are trying to perform, or each plot you are aiming to create has been done before. One of my favourite aspects of R is the community of users who help others through online tutorials and blog posts. All of my initial successes in using R were from adapting the code of others who had created tutorials. When you are unfamiliar with the programming language, it is helpful to copy something you know that works and change it from there. Use other people’s experience wisely and take advantage of it.</p>
<ol start="4" type="1">
<li>Use package help documents</li>
</ol>
<p>R thrives through the input of its users, and many create specific packages for specific problems. Their functions can contain a lot of arguments and unless you repeatedly use a package it is difficult to remember each one. For each package there is usually a help document that outlines each of the functions within the package, and explains what each argument within those functions does. I often have the help package open when I writing the code so I can keep referring back to the manual.</p>
</section>
<section id="useful-resources" class="level2">
<h2 class="anchored" data-anchor-id="useful-resources">Useful resources</h2>
<section id="books" class="level3">
<h3 class="anchored" data-anchor-id="books">Books</h3>
<p><a href="https://us.sagepub.com/en-us/nam/discovering-statistics-using-r/book236067%20">Discovering statistics using R</a> – Andy Field, Jeremy Miles, and Zoe Field</p>
<p>This book is aimed towards psychology, but it is one of the best introductory books on statistics and programming in R. It includes both statistical theory and downloadable R code and tutorials to follow. I would hugely recommend this as a starting point, particularly if you are a psychology student.</p>
<p><a href="https://leanpub.com/rprogramming">R Programming for Data Science</a> – Roger D. Peng</p>
<p>With over 90,000 readers on Leanpub, this is a hugely successful book that outlines the fundamentals of R programming. I would not recommend it as a starting point, but it is indispensable when you want to brush up on the programming language.</p>
<p><a href="http://ggplot2.org/book/">ggplot2</a> – Hadley Wickham</p>
<p>This is my favourite package for creating plots. As well as having some of the most helpful documentation to help you with coding, there is an accompanying book for if you want to read more about the underlying theory of ggplot2. As I spent a lot of time using R for creating plots, this book was useful in showing the full capabilities of the package.</p>
<p><a href="https://health.adelaide.edu.au/psychology/ccs/teaching/lsr/">Learning statistics with R</a> – Daniel Navarro</p>
<p>As well as the advantage of it being free (although I do encourage you to buy a copy), this is one of my favourite guides to using R. Similar to Discovering statistics using R, the book is organised by starting with the underlying statistical principles and then providing tutorials. The examples utilise the data sets incorporated into R and the accompanying package to the book, so it is easy to follow along without additional downloads.</p>
<p><a href="http://nathanieldphillips.com/thepiratesguidetor/">YaRrr! The Pirate’s Guide to R</a> - Nathaniel D Phillips</p>
<p>This is a guide I have only just come across, which is a shame as it is the perfect introduction to R. It uses humourous examples (mainly pirate based) and guides you through everything from navigating the R environment, manipulating data, and data analysis. If you are yet to start learning R, this is another brilliant (and free! but try and donate some money if you can) starting point.</p>
</section>
<section id="blogs" class="level3">
<h3 class="anchored" data-anchor-id="blogs">Blogs</h3>
<p><a href="https://www.r-bloggers.com/">R-Bloggers</a></p>
<p>This is a kind of blog of blogs (a meta-blog if you will). R-bloggers is a collection of tutorials creating by other R users on a range of topics including simulation, analysis, and creating plots. This website has been crucial for me, so if you want to learn how to do something with R, I would suggest having a look here first.</p>
<p><a href="http://www.statmethods.net/index.html">Quick-R</a></p>
<p>This is a website full of tutorials on how to perform analyses and create plots in R. Most of the sections are very straight forward so it would be an advantage to be familiar with the underlying concepts beforehand. Robert Kabacoff, the creator of the website, also has a book called R in Action.</p>
<p><a href="http://www.cookbook-r.com/">Cookbook for R</a></p>
<p>This is another website with tutorials and examples on how to perform analyses. It is particular useful for ggplot2 as it covers a range of common features such as how to rename axes and using facets. Similar to Quick-R, there is also an accompanying book called R Graphics Cookbook which extends many of the website features.</p>
</section>
<section id="other" class="level3">
<h3 class="anchored" data-anchor-id="other">Other</h3>
<p><a href="http://stackoverflow.com/">Stack Overflow</a></p>
<p>This is a general programming Q&amp;A that is not specific to R. However, there are a lot of questions on here that have been answered about R problems. Although I have never done it myself, if you are totally stuck and need some assistance, you can post a question and hope someone can provide you with an answer. These posts typically appear when I Google a problem, so it can be an incredibly useful source of information.</p>
<p><a href="https://www.rstudio.com/resources/cheatsheets/">R Studio cheat sheets</a> – R Studio</p>
<p>R studio is a user interface that is used in conjunction with R. I’ve never used R without the addition of R studio as it makes everything a little easier. On top of this, they create cheat sheets to organise the different functions of each of their packages. Remembering the functions for each package is difficult, so these are always a handy reminder. They have one for R Markdown, ggplot2, dplyr, tidyr, and a few other. If you need a quick guide without trawling through the documentation, this is a good place to start.</p>
<p>Have I missed anything that you have found useful when learning R? Feel free to leave a comment and I will add it to the list.</p>


</section>
</section>

<p><a href="https://creativecommons.org">This website</a> © 2025 by <a href="https://creativecommons.org">James Bartlett</a> is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a><img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" style="max-width: 1em;max-height:1em;margin-left: .2em;"><img src="https://mirrors.creativecommons.org/presskit/icons/by.svg" style="max-width: 1em;max-height:1em;margin-left: .2em;"></p></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>